/*! For license information please see annotorious-selector-pack.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Annotorious=t():(e.Annotorious=e.Annotorious||{},e.Annotorious.SelectorPack=t())}(self,(function(){return(()=>{var e={94:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}e.exports=function e(n,r){if(n===r)return!0;if(n&&r&&"object"==t(n)&&"object"==t(r)){if(n.constructor!==r.constructor)return!1;var o,i,u;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!e(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(u=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,u[i]))return!1;for(i=o;0!=i--;){var a=u[i];if(!e(n[a],r[a]))return!1}return!0}return n!=n&&r!=r}},773:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,u=r.length;i<u;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";n.d(r,{default:()=>Mt});var e,t=n(773),o=n.n(t),i="http://www.w3.org/2000/svg",u=function(e,t){var n=function(e){var t=e.getAttribute("class");return t?new Set(t.split(" ")):new Set}(e);n.add(t),e.setAttribute("class",Array.from(n).join(" "))},a=new Uint8Array(16);function c(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(a)}const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&l.test(e)};for(var f=[],p=0;p<256;++p)f.push((p+256).toString(16).substr(1));const d=function(e,t,n){var r=(e=e||{}).random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var y=n(94),b=n.n(y);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"clone",(function(t,n){return new e(g(g({},r.underlying),t),g(g({},r.opts),n))})),m(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),this.underlying=t,this.opts=n}var t,n;return t=e,(n=[{key:"isEqual",value:function(e){return"Annotation"===(null==e?void 0:e.type)&&(this.underlying===e.underlying||!(!this.underlying.id||!e.underlying.id)&&b()(this.underlying,e.underlying))}},{key:"readOnly",get:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(e){this.underlying.body=e}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"start",get:function(){return this.selector("TextPositionSelector").start}},{key:"end",get:function(){return this.selector("TextPositionSelector").end}}])&&v(t.prototype,n),e}();function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}m(w,"create",(function(e){var t={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(d()),body:[]};return new w(g(g({},t),e))}));var E=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j(this,"clone",(function(t){var n=new e;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),t&&(n.underlying=O(O({},n.underlying),t)),n})),j(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),j(this,"toAnnotation",(function(){var e=Object.assign({},r.underlying,{"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(d())});return new w(e)})),this.underlying={type:"Selection",body:n||[],target:t}}var t,n;return t=e,(n=[{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(e){return!!e&&b()(this.underlying,e.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"isSelection",get:function(){return!0}}])&&A(t.prototype,n),e}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function M(e,t){return M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},M(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G(e);if(t){var o=G(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _(this,n)}}function _(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H="An implementation is missing",D="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,B=function(e){C(n,e);var t=R(n);function n(e,r,o){var u;return k(this,n),N(T(u=t.call(this)),"getSVGPoint",(function(e){var t=u.svg.createSVGPoint();if(D){var n=u.svg.getBoundingClientRect(),r=e.clientX-n.x,o=e.clientY-n.y,i=u.svg.getBoundingClientRect(),a=i.left,c=i.top;return t.x=r+a,t.y=o+c,t.matrixTransform(u.g.getScreenCTM().inverse())}return t.x=e.offsetX,t.y=e.offsetY,t.matrixTransform(u.g.getCTM().inverse())})),N(T(u),"drawHandle",(function(e,t){var n=document.createElementNS(i,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(i,"g"),o=function(n){var r=document.createElementNS(i,"circle");return r.setAttribute("cx",e),r.setAttribute("cy",t),r.setAttribute("r",n),r},a=u.config.handleRadius||6,c=o(a);c.setAttribute("class","a9s-handle-inner");var l=o(a+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),N(T(u),"setHandleXY",(function(e,t,n){var r=e.querySelector(".a9s-handle-inner");r.setAttribute("cx",t),r.setAttribute("cy",n);var o=e.querySelector(".a9s-handle-outer");o.setAttribute("cx",t),o.setAttribute("cy",n)})),N(T(u),"getHandleXY",(function(e){var t=e.querySelector(".a9s-handle-outer");return{x:parseFloat(t.getAttribute("cx")),y:parseFloat(t.getAttribute("cy"))}})),N(T(u),"scaleHandles",(function(e){var t;null===(t=u.handles)||void 0===t||t.forEach((function(t){var n=t.querySelector(".a9s-handle-inner"),r=t.querySelector(".a9s-handle-outer"),o=e*(u.config.handleRadius||6);n.setAttribute("r",o),r.setAttribute("r",o)}))})),u.svg=e.closest("svg"),u.g=e,u.config=r,u.env=o,u}return n}(o()),L=function(e){C(o,e);var t,n,r=R(o);function o(e,t,n){var i;return k(this,o),N(T(i=r.call(this,e,t,n)),"attachListeners",(function(e){var t=e.mouseMove,n=e.mouseUp,r=e.dblClick;t&&(i.mouseMove=function(e){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.started||(i.emit("startSelection",{x:r,y:o}),i.started=!0),t(r,o,e)},i.svg.addEventListener("mousemove",i.mouseMove)),n&&(i.mouseUp=function(e){if(0===e.button){var t=i.getSVGPoint(e),r=t.x,o=t.y;n(r,o,e)}},document.addEventListener("mouseup",i.mouseUp)),r&&(i.dblClick=function(e){var t=i.getSVGPoint(e),n=t.x,o=t.y;r(n,o,e)},document.addEventListener("dblclick",i.dblClick))})),N(T(i),"detachListeners",(function(){i.mouseMove&&i.svg.removeEventListener("mousemove",i.mouseMove),i.mouseUp&&document.removeEventListener("mouseup",i.mouseUp),i.dblClick&&document.removeEventListener("dblclick",i.dblClick)})),N(T(i),"start",(function(e){var t=i.getSVGPoint(e),n=t.x,r=t.y;i.startDrawing(n,r,e)})),N(T(i),"startDrawing",(function(e){throw new Error(H)})),N(T(i),"createEditableShape",(function(e){throw new Error(H)})),i.started=!1,i}return t=o,(n=[{key:"isDrawing",get:function(){throw new Error(H)}}])&&P(t.prototype,n),o}(B);L.supports=function(e){throw new Error(H)};var X=function(e){var t=function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(e){return e.parentNode.removeChild(e)})),t(e),Array.from(e.querySelectorAll("*")).forEach(t),e},Y=function(e){var t,n,r=e.selector("SvgSelector");if(r){var o=new DOMParser,u=r.value,a=o.parseFromString(u,"image/svg+xml"),c=a.lookupPrefix(i),l=a.lookupNamespaceURI(null);return c||l?X(a).firstChild:X((t=a,n=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",'<svg xmlns="'.concat(i,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},q=function(e){var t=Y(e),n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},U=function(e,t){var n=e.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(i,'"'),""),{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}},F=function(e,t,n,r){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("r",r)},z=function(e,t,n,r){var o=e.querySelector(".a9s-inner"),i=e.querySelector(".a9s-outer");F(o,t,n,r),F(i,t,n,r)},V=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),r:parseFloat(t.getAttribute("r"))}};function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),W(this,"redraw",(function(){var e=V(r.circle),t=e.cx,n=e.cy,o=e.r,i=t+o>r.w?r.w-o:t,u=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(u," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),W(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=n;var o=V(this.circle),u=o.cx,a=o.cy,c=o.r,l=u+c>this.w?this.w-c:u,s=a+c>this.h?this.h-c:a+c;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&I(t.prototype,n),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var K=function(){function e(t,n,r,o){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Q(this,"dragTo",(function(e,t){var n=u.env.image,r=n.naturalWidth,o=n.naturalHeight;u.group.style.display=null;var i=e-u.anchor[0],a=t-u.anchor[1],c=Math.max(1,Math.pow(Math.pow(i,2)+Math.pow(a,2),.5)/2),l=u.anchor[0]+i/2,s=u.anchor[1]+a/2;l-c<0||l+c>r||s-c<0||s+c>o||(z(u.circle,l,s,c),u.mask.redraw())})),Q(this,"getBoundingClientRect",(function(){return u.circle.getBoundingClientRect()})),Q(this,"toSelection",(function(){return new E(U(u.group,u.env.image))})),Q(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.circle=null,u.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.circle=function(e,t,n){var r=document.createElementNS(i,"g"),o=document.createElementNS(i,"circle"),u=document.createElementNS(i,"circle");return u.setAttribute("class","a9s-inner"),F(u,e,t,2),o.setAttribute("class","a9s-outer"),F(o,e,t,2),r.appendChild(o),r.appendChild(u),r}(t,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new $(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.circle}}])&&J(t.prototype,n),e}();function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e,t){return te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},te(e,t)}function ne(e,t){if(t&&("object"===Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return re(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue="An implementation is missing",ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=oe(r);if(o){var n=oe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ne(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),ie(re(o=i.call(this,t,n,r)),"enableResponsive",(function(){window.ResizeObserver&&(o.resizeObserver=new ResizeObserver((function(){var e=o.svg.getBoundingClientRect(),t=o.svg.viewBox.baseVal,n=t.width,r=t.height,i=Math.max(n/e.width,r/e.height);o.scaleHandles(i)})),o.resizeObserver.observe(o.svg.parentNode))})),ie(re(o),"updateState",(function(e){throw new Error(ue)})),o.annotation=e,o.handles=[];var a=r.image;return(a instanceof Element||a instanceof HTMLDocument)&&o.enableResponsive(),o}return t=u,(n=[{key:"element",get:function(){throw new Error(ue)}},{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}])&&ee(t.prototype,n),u}(B),ce=/firefox/i.test(navigator.userAgent),le=function(e,t,n,r,o){e.setAttribute("width",r),e.setAttribute("height",o),ce?(e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("transform","translate(".concat(t,", ").concat(n,")"))):(e.setAttribute("x",t),e.setAttribute("y",n))},se=function(e,t){var n=t.getBBox(),r=n.x,o=n.y,u=n.width,a=n.height,c=document.createElementNS(i,"svg");c.setAttribute("class","a9s-formatter-el"),le(c,r,o,u,a);var l=document.createElementNS(i,"g");l.appendChild(e),c.appendChild(l),t.append(c)},fe=function(e,t,n){if(!n)return e;var r=n(t);if(!r)return e;if("string"==typeof r||r instanceof String)u(e,r);else if(r.nodeType===Node.ELEMENT_NODE)se(r,e);else{var o=r.className,i=r.style,a=r.element;if(o&&u(e,o),i){var c=e.querySelector(".a9s-outer"),l=e.querySelector(".a9s-inner");c&&l?(c.setAttribute("style","display:none"),l.setAttribute("style",i)):e.setAttribute("style",i)}for(var s in a&&se(a,e),r)r.hasOwnProperty(s)&&s.startsWith("data-")&&e.setAttribute(s,r[s])}},pe=function(e,t,n,r,o){var i=e.querySelector(".a9s-formatter-el");i&&le(i,t,n,r,o)};function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?be(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t,n){return ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Se(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ge(e,t,n||e)}function ve(e,t){return ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ve(e,t)}function me(e,t){if(t&&("object"===de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return we(e)}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(a,e);var t,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(r);if(o){var n=Se(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return me(this,e)});function a(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Oe(we(o=u.call(this,e,t,n,r)),"setSize",(function(e,t,n){z(o.circle,e,t,n),o.mask.redraw(),pe(o.elementGroup,e,t,n,n);var r=ye(o.handles,4),i=r[0],u=r[1],a=r[2],c=r[3];o.setHandleXY(i,e,t-n),o.setHandleXY(u,e+n,t),o.setHandleXY(a,e,t+n),o.setHandleXY(c,e-n,t)})),Oe(we(o),"stretchCorners",(function(e,t,n){var r,i=o.getHandleXY(t),u=n.x,a=n.y,c=0,l=0;0==e||2==e?(u=i.x,l=a-i.y,r=Math.abs(l)/2):(a=i.y,c=u-i.x,r=Math.abs(c)/2);var s=c>0?i.x:u,f=l>0?i.y:a,p=s+Math.abs(c)/2,d=f+Math.abs(l)/2;if(z(o.circle,p,d,r),o.mask.redraw(),pe(o.elementGroup,p,d,r,r),0==e||2==e){var y=0,b=2;(0==e&&l>0||2==e&&l<0)&&(y=2,b=0),o.setHandleXY(o.handles[y],p,d-r),o.setHandleXY(o.handles[b],p,d+r),o.setHandleXY(o.handles[1],p+r,d),o.setHandleXY(o.handles[3],p-r,d)}else{var h=3,g=1;(1==e&&c>0||3==e&&c<0)&&(h=1,g=3),o.setHandleXY(o.handles[h],p+r,d),o.setHandleXY(o.handles[g],p-r,d),o.setHandleXY(o.handles[0],p,d-r),o.setHandleXY(o.handles[2],p,d+r)}})),Oe(we(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=V(o.circle),i=r.cx,u=r.cy;o.grabbedAt={x:n.x-i,y:n.y-u}}})),Oe(we(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.circle){var r=V(o.circle).r,i=o.env.image,u=i.naturalWidth,a=i.naturalHeight,c=Math.max(t(n.x-o.grabbedAt.x,u-r),r),l=Math.max(t(n.y-o.grabbedAt.y,a-r),r);o.setSize(c,l,r),o.emit("update",U(o.circle,o.env.image))}else{var s=o.handles.indexOf(o.grabbedElem),f=s<2?o.handles[s+2]:o.handles[s-2];o.stretchCorners(s,f,n),o.emit("update",U(o.circle,o.env.image))}}})),Oe(we(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Oe(we(o),"updateState",(function(e){var t=Y(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("r"));o.setSize(n,r,i)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.circle=q(e),o.circle.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.circle)),o.mask=new $(r.image,o.circle),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.circle);var c=V(o.circle),l=c.cx,s=c.cy,f=c.r;return o.handles=[[l,s-f],[l+f,s],[l,s+f],[l-f,s]].map((function(e){var t=ye(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),fe(o.circle,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=a,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ge(Se(a.prototype),"destroy",this).call(this)}}])&&he(t.prototype,n),a}(ae);function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t){return xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xe(e,t)}function Pe(e,t){if(t&&("object"===je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ke(e)}function ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ce(r);if(o){var n=Ce(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Pe(this,e)});function u(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Me(ke(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new K(e,t,r.g,r.env)})),Me(ke(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Me(ke(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),Me(ke(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var u=r.rubberband.element;u.annotation=r.rubberband.toSelection(),r.emit("complete",u)}else r.emit("cancel");r.stop()})),Me(ke(r),"createEditableShape",(function(e){return new Ae(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=u,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&Ee(t.prototype,n),u}(L);Re.identifier="circle",Re.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<circle/g)};var _e=function(e,t,n,r,o){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("rx",r),e.setAttribute("ry",o)},Te=function(e,t,n,r,o){var i=e.querySelector(".a9s-inner"),u=e.querySelector(".a9s-outer");_e(i,t,n,r,o),_e(u,t,n,r,o)},Ge=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),rx:parseFloat(t.getAttribute("rx")),ry:parseFloat(t.getAttribute("ry"))}};function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var De=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),He(this,"redraw",(function(){var e=Ge(r.ellipse),t=e.cx,n=e.cy,o=e.rx,i=e.ry,u=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(t," ").concat(u," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),He(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=n;var o=Ge(this.ellipse),u=o.cx,a=o.cy,c=o.rx,l=o.ry,s=a+l;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(u," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&Ne(t.prototype,n),e}();function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xe=function(){function e(t,n,r,o){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Le(this,"dragTo",(function(e,t){u.group.style.display=null;var n=e-u.anchor[0],r=t-u.anchor[1],o=n>0?u.anchor[0]+n/2:e+n/2,i=r>0?u.anchor[1]+r/2:t+r/2,a=Math.abs(n/2),c=Math.abs(r/2);Te(u.ellipse,o,i,a,c),u.mask.redraw()})),Le(this,"getBoundingClientRect",(function(){return u.ellipse.getBoundingClientRect()})),Le(this,"toSelection",(function(){return new E(U(u.group,u.env.image))})),Le(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.ellipse=null,u.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.ellipse=function(e,t,n,r){var o=document.createElementNS(i,"g"),u=document.createElementNS(i,"ellipse"),a=document.createElementNS(i,"ellipse");return u.setAttribute("class","a9s-inner"),_e(u,e,t,2,r),a.setAttribute("class","a9s-outer"),_e(a,e,t,2,r),o.appendChild(a),o.appendChild(u),o}(t,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new De(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.ellipse}}])&&Be(t.prototype,n),e}();function Ye(e){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ye(e)}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ze(e,t,n){return ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$e(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ze(e,t,n||e)}function Ve(e,t){return Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ve(e,t)}function Ie(e,t){if(t&&("object"===Ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return We(e)}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $e(e){return $e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},$e(e)}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(a,e);var t,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=$e(r);if(o){var n=$e(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ie(this,e)});function a(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Je(We(o=u.call(this,e,t,n,r)),"setSize",(function(e,t,n,r){Te(o.ellipse,e,t,n,r),o.mask.redraw(),pe(o.elementGroup,e,t,n,r);var i=qe(o.handles,4),u=i[0],a=i[1],c=i[2],l=i[3];o.setHandleXY(u,e,t-r),o.setHandleXY(a,e+n,t),o.setHandleXY(c,e,t+r),o.setHandleXY(l,e-n,t)})),Je(We(o),"stretchCorners",(function(e,t,n,r){var i=o.getHandleXY(t),u=o.getHandleXY(n),a=r.x,c=r.y,l=0,s=0;0==e||2==e?a=i.x:c=i.y;var f=a-i.x,p=c-i.y,d=f>0?i.x:a,y=p>0?i.y:c,b=Math.abs(f),h=Math.abs(p),g=d+b/2,v=y+h/2;if(l=b/2,s=h/2,0==e||2==e?l=Math.abs(i.x-u.x):s=Math.abs(i.y-u.y),Te(o.ellipse,g,v,l,s),o.mask.redraw(),pe(o.elementGroup,g,v,l,s),0==e||2==e){var m=0,w=2;(0==e&&p>0||2==e&&p<0)&&(m=2,w=0),o.setHandleXY(o.handles[m],g,v-s),o.setHandleXY(o.handles[w],g,v+s),o.setHandleXY(o.handles[1],g+l,v),o.setHandleXY(o.handles[3],g-l,v)}else{var S=3,O=1;(1==e&&f>0||3==e&&f<0)&&(S=1,O=3),o.setHandleXY(o.handles[S],g+l,v),o.setHandleXY(o.handles[O],g-l,v),o.setHandleXY(o.handles[0],g,v-s),o.setHandleXY(o.handles[2],g,v+s)}})),Je(We(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=Ge(o.ellipse),i=r.cx,u=r.cy;o.grabbedAt={x:n.x-i,y:n.y-u}}})),Je(We(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.ellipse){var r=Ge(o.ellipse),i=r.rx,u=r.ry,a=o.env.image,c=a.naturalWidth,l=a.naturalHeight,s=t(n.x-o.grabbedAt.x,c-i),f=t(n.y-o.grabbedAt.y,l-u);o.setSize(s,f,i,u),o.emit("update",U(o.ellipse,o.env.image))}else{var p=o.handles.indexOf(o.grabbedElem),d=p<2?o.handles[p+2]:o.handles[p-2],y=o.handles[(p+3)%4];o.stretchCorners(p,d,y,n),o.emit("update",U(o.ellipse,o.env.image))}}})),Je(We(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Je(We(o),"updateState",(function(e){var t=Y(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("rx")),u=parseFloat(t.getAttribute("ry"));o.setSize(n,r,i,u)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.ellipse=q(e),o.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.ellipse)),o.mask=new De(r.image,o.ellipse),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.ellipse);var c=Ge(o.ellipse),l=c.cx,s=c.cy,f=c.rx,p=c.ry;return o.handles=[[l,s-p],[l+f,s],[l,s+p],[l-f,s]].map((function(e){var t=qe(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),fe(o.ellipse,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=a,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ze($e(a.prototype),"destroy",this).call(this)}}])&&Fe(t.prototype,n),a}(ae);function Ke(e){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t){return et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e,t){if(t&&("object"===Ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return nt(e)}function nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rt(e){return rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},rt(e)}function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var it=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rt(r);if(o){var n=rt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return tt(this,e)});function u(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),ot(nt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Xe(e,t,r.g,r.env)})),ot(nt(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),ot(nt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),ot(nt(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var u=r.rubberband.element;u.annotation=r.rubberband.toSelection(),r.emit("complete",u)}else r.emit("cancel");r.stop()})),ot(nt(r),"createEditableShape",(function(e){return new Qe(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=u,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&Ze(t.prototype,n),u}(L);function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function at(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}it.identifier="ellipse",it.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<ellipse/g)};var lt=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ct(this,"setPoints",(function(e){var t=e.map((function(e){return"L".concat(e[0]," ").concat(e[1])})).join(" ");t="M"+t.substring(1),o.outer.setAttribute("d",t),o.inner.setAttribute("d",t)})),ct(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),ct(this,"dragTo",(function(e){o.group.style.display=null,o.addPoint(e)})),ct(this,"addPoint",(function(e){var t;o.points=[].concat(function(e){if(Array.isArray(e))return ut(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ut(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]),o.setPoints(o.points)})),ct(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),ct(this,"toSelection",(function(){return new E(U(o.group,o.env.image))})),this.points=[t],this.env=r,this.group=document.createElementNS(i,"g"),this.freehand=document.createElementNS(i,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.freehand}}])&&at(t.prototype,n),e}();function st(e){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(e)}function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pt(e,t){return pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},pt(e,t)}function dt(e,t){if(t&&("object"===st(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return yt(e)}function yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e,t,n){return bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ht(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},bt(e,t,n||e)}function ht(e){return ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ht(e)}function gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vt=function(e){var t=e.getAttribute("d").split("L"),n=[];if(t.length>0){var r=t[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<t.length;o++)r=t[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},mt=function(e){return e.querySelector(".a9s-inner").getBBox()},wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(a,e);var t,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ht(r);if(o){var n=ht(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return dt(this,e)});function a(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),gt(yt(c=u.call(this,e,t,n,r)),"setPoints",(function(e){var t=function(e){return Math.round(10*e)/10},n=e.map((function(e){return"L".concat(t(e.x)," ").concat(t(e.y))})).join(" ");n="M"+n.substring(1),c.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=c.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,u=o.y,a=o.width,l=o.height;pe(c.elementGroup,i,u,a,l)})),gt(yt(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),gt(yt(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e),r=mt(c.shape),o=r.x,i=r.y,u=r.width,a=r.height;if(c.grabbedElem===c.shape){var l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-u),d=t(i,n.y-c.grabbedAt.y,f-a),y=c.shape.querySelector(".a9s-inner"),b=vt(y).map((function(e){return{x:e.x+p,y:e.y+d}}));c.grabbedAt=n,c.setPoints(b),c.emit("update",U(c.shape,c.env.image))}}})),gt(yt(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),gt(yt(c),"updateState",(function(e){var t=vt(Y(e));c.setPoints(t)})),gt(yt(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),bt((o=yt(c),ht(a.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=q(e),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),fe(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var l=mt(c.shape);return l.x,l.y,l.width,l.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=a,(n=[{key:"element",get:function(){return this.elementGroup}}])&&ft(t.prototype,n),a}(ae);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function At(e,t){return At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},At(e,t)}function jt(e,t){if(t&&("object"===St(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Et(e)}function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xt(e){return xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xt(e)}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=xt(r);if(o){var n=xt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return jt(this,e)});function u(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Pt(Et(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new lt([e,t],r.g,r.env)})),Pt(Et(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Pt(Et(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),Pt(Et(r),"onMouseUp",(function(e,t){r.onDblClick(e,t)})),Pt(Et(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]),r.detachListeners();var n=r.rubberband.getBoundingClientRect(),o=n.width,i=n.height,u=r.config.minSelectionWidth||4,a=r.config.minSelectionHeight||4;if(o>=u||i>=a){var c=r.rubberband.element;c.annotation=r.rubberband.toSelection(),r.emit("complete",c)}else r.emit("cancel");r.stop()})),Pt(Et(r),"createEditableShape",(function(e){return new wt(e,r.g,r.config,r.env)})),r._isDrawing=!1,r}return t=u,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Ot(t.prototype,n),u}(L);kt.identifier="freehand",kt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<path/g)};var Ct=new Set(["circle","ellipse","freehand"]);const Mt=function(e,t){var n=null!=t&&t.tools?new Set(t.tools.map((function(e){return e.toLowerCase()}))):Ct;n.has("circle")&&e.addDrawingTool(Re),n.has("ellipse")&&e.addDrawingTool(it),n.has("freehand")&&e.addDrawingTool(kt)}})(),r.default})()}));
//# sourceMappingURL=annotorious-selector-pack.min.js.map